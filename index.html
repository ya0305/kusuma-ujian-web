<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Ujian Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin: 0;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 90%;
            max-width: 1000px;
            margin: 20px auto;
            position: relative;
        }

        .header {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .section {
            display: none;
            padding: 30px;
        }

        .section.active {
            display: block;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        input[type="password"], input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .btn {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            margin-top: 10px;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            color: #dc2626;
            margin: 20px 0;
            padding: 20px;
            background: #fef2f2;
            border-radius: 10px;
            border: 2px solid #fecaca;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .exam-info {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
            margin: 20px 0;
        }

        .panel-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .control-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }

        .bell-animation {
            animation: ring 0.5s ease-in-out;
        }

        @keyframes ring {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .google-form-embed {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .hidden {
            display: none !important;
        }

        /* Anti-cheat status indicators */
        .status-indicators {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .status-dot.warning {
            background: #ff9800;
            animation: pulse 1s infinite;
        }

        .status-dot.danger {
            background: #f44336;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .warning-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            flex-direction: column;
        }

        .warning-overlay.show {
            display: flex;
        }

        .warning-content {
            text-align: center;
            padding: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            max-width: 500px;
        }

        .violation-count {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: inline-block;
            font-size: 1.2rem;
        }

        .student-info {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
            margin-bottom: 20px;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(76, 175, 80, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .section {
                padding: 20px;
            }
            
            .timer-display {
                font-size: 36px;
            }

            .status-indicators {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Sistem Ujian Online</h1>
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('student')">Halaman Siswa</button>
                <button class="nav-btn" onclick="showSection('teacher-login')">Panel Guru</button>
            </div>
        </div>

        <!-- Student Section -->
        <div id="student" class="section active">
            <!-- Student Info Form -->
            <div id="student-setup" class="student-info">
                <h3>üìù Informasi Siswa</h3>
                <div class="form-group">
                    <label for="student-name">Nama Lengkap:</label>
                    <input type="text" id="student-name" placeholder="Masukkan nama lengkap Anda">
                </div>
                <button class="btn" onclick="registerStudent()">Daftar Ujian</button>
            </div>

            <!-- Waiting State -->
            <div id="exam-waiting" class="exam-info">
                <h2>‚è≥ Menunggu Ujian Dimulai</h2>
                <p>Silakan tunggu guru memulai ujian. Timer akan muncul ketika ujian sudah dimulai.</p>
                <div id="exam-title" style="font-size: 18px; font-weight: bold; margin-top: 10px; color: #4f46e5;">
                    Belum ada ujian yang diset
                </div>
            </div>

            <!-- Active Exam -->
            <div id="exam-active" class="hidden">
                <!-- Anti-cheat Status Indicators -->
                <div class="status-indicators">
                    <div class="status-item">
                        <div class="status-dot" id="focus-status"></div>
                        <span>Focus Mode</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot" id="fullscreen-status"></div>
                        <span>Fullscreen</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot" id="tab-status"></div>
                        <span>Tab Active</span>
                    </div>
                </div>

                <div class="exam-info">
                    <h2 id="current-exam-title">Nama Ujian</h2>
                    <div class="timer-display" id="timer-display">00:00:00</div>
                    <div class="alert alert-warning" id="time-warning" style="display: none;">
                        ‚ö†Ô∏è Waktu tersisa kurang dari 5 menit!
                    </div>
                </div>

                <!-- Google Form Container -->
                <div id="google-form-container" class="hidden">
                    <h3>üìù Soal Ujian</h3>
                    <iframe id="google-form-frame" class="google-form-embed" src=""></iframe>
                </div>

                <!-- End Exam Button -->
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-danger" onclick="endExamManually()">üèÅ Akhiri Ujian</button>
                </div>

                <div class="alert alert-danger" id="exam-ended" style="display: none;">
                    ‚è∞ Waktu ujian telah berakhir! Silakan submit jawaban Anda.
                </div>
            </div>
        </div>

        <!-- Teacher Login -->
        <div id="teacher-login" class="section">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px;">üîê Login Guru</h2>
                <div class="form-group">
                    <label for="teacher-password">Password:</label>
                    <input type="password" id="teacher-password" placeholder="Masukkan password guru">
                </div>
                <button class="btn" onclick="loginTeacher()">Masuk</button>
                <div id="login-error" class="alert alert-danger" style="display: none; margin-top: 15px;">
                    Password salah! Silakan coba lagi.
                </div>
            </div>
        </div>

        <!-- Teacher Panel -->
        <div id="teacher-panel" class="section">
            <div class="alert alert-success">
                ‚úÖ Selamat datang di Panel Guru!
            </div>

            <div class="panel-controls">
                <div class="control-card">
                    <h3>üìã Setting Ujian</h3>
                    <div class="form-group">
                        <label for="exam-name">Nama Ujian:</label>
                        <input type="text" id="exam-name" placeholder="Contoh: Ujian Matematika Kelas 10">
                    </div>
                    
                    <div class="form-group">
                        <label for="exam-duration">Durasi (menit):</label>
                        <input type="number" id="exam-duration" placeholder="Contoh: 90" min="1" max="300">
                    </div>

                    <div class="form-group">
                        <label for="google-form-url">Link Google Form:</label>
                        <textarea id="google-form-url" rows="3" placeholder="https://docs.google.com/forms/d/e/1FAIpQLSe.../viewform"></textarea>
                        <small style="color: #6b7280;">Pastikan Google Form sudah di-set untuk bisa diakses oleh semua orang</small>
                    </div>

                    <button class="btn" onclick="setExam()">Set Ujian</button>
                </div>

                <div class="control-card">
                    <h3>‚è±Ô∏è Kontrol Timer</h3>
                    <div class="timer-display" id="teacher-timer">00:00:00</div>
                    
                    <div class="timer-controls">
                        <button class="btn" id="start-btn" onclick="startExam()">‚ñ∂Ô∏è Mulai</button>
                        <button class="btn btn-secondary" onclick="pauseExam()">‚è∏Ô∏è Pause</button>
                        <button class="btn btn-secondary" onclick="stopExam()">‚èπÔ∏è Stop</button>
                    </div>

                    <div id="timer-status" class="alert alert-warning" style="display: none;">
                        Timer belum diatur
                    </div>
                </div>

                <div class="control-card">
                    <h3>üîß Kontrol Lainnya</h3>
                    <button class="btn btn-secondary" onclick="ringBell()">üîî Bunyikan Bell</button>
                    <button class="btn btn-secondary" onclick="resetAll()" style="margin-top: 10px;">üîÑ Reset Semua</button>
                    <button class="btn btn-secondary" onclick="logout()" style="margin-top: 10px;">üö™ Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Button -->
    <button class="fullscreen-btn" id="fullscreen-btn" onclick="toggleFullscreen()" style="display: none;">
        üî≥ Fullscreen
    </button>

    <!-- Anti-cheat Warning Overlay -->
    <div class="warning-overlay" id="warning-overlay">
        <div class="warning-content">
            <h2>‚ö†Ô∏è PERINGATAN!</h2>
            <p id="warning-message">Anda telah melanggar aturan ujian!</p>
            <div class="violation-count">
                Pelanggaran: <span id="violation-count">1</span>/3
            </div>
            <p>Klik tombol di bawah untuk melanjutkan ujian</p>
            <button class="btn" onclick="hideWarning()" style="margin-top: 20px; width: auto; padding: 10px 30px;">
                ‚úÖ Kembali ke Ujian
            </button>
        </div>
    </div>

    <!-- Audio for bell -->
    <audio id="bell-sound" preload="auto">
        <source src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAAS9MYXZmNjAuMTYuMTAwAAAAAAAAAAAAAAAAAP/7kGQAAP8AAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABP/7kGQAAP8AAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABP/7kGQAAP8AAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABP/7kGQAAP8AAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABAAAAAAAAAAA" type="audio/mpeg">
    </audio>

    <script>
        // Konfigurasi
        const TEACHER_PASSWORD = "guru123"; // Ganti dengan password yang diinginkan
        
        // State Management
        let examState = {
            isActive: false,
            isPaused: false,
            duration: 0,
            remainingTime: 0,
            examName: "",
            googleFormUrl: "",
            interval: null
        };

        // Anti-cheat variables
        let studentName = "";
        let violationCount = 0;
        let maxViolations = 3;
        let tabSwitchCount = 0;
        let focusLostCount = 0;
        let isFullscreen = false;
        let antiCheatActive = false;

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Student Registration
        function registerStudent() {
            const name = document.getElementById('student-name').value.trim();
            if (!name) {
                alert('Mohon masukkan nama lengkap Anda!');
                return;
            }
            
            studentName = name;
            document.getElementById('student-setup').style.display = 'none';
            
            // Initialize anti-cheat when student registers
            initializeAntiCheat();
            
            alert(`Selamat datang, ${name}! Silakan tunggu guru memulai ujian.`);
        }

        // Teacher Login
        function loginTeacher() {
            const password = document.getElementById('teacher-password').value;
            const errorDiv = document.getElementById('login-error');
            
            if (password === TEACHER_PASSWORD) {
                showSection('teacher-panel');
                document.getElementById('teacher-password').value = '';
                errorDiv.style.display = 'none';
                updateTeacherTimer();
            } else {
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'Password salah! Silakan coba lagi.';
            }
        }

        // Logout
        function logout() {
            showSection('student');
            document.getElementById('teacher-password').value = '';
        }

        // Set Exam Configuration
        function setExam() {
            const examName = document.getElementById('exam-name').value.trim();
            const duration = parseInt(document.getElementById('exam-duration').value);
            const googleFormUrl = document.getElementById('google-form-url').value.trim();
            
            if (!examName || !duration || duration <= 0) {
                alert('Silakan isi nama ujian dan durasi yang valid!');
                return;
            }
            
            examState.examName = examName;
            examState.duration = duration * 60; // Convert to seconds
            examState.remainingTime = examState.duration;
            examState.googleFormUrl = googleFormUrl;
            
            // Update UI
            document.getElementById('exam-title').textContent = examName;
            document.getElementById('current-exam-title').textContent = examName;
            document.getElementById('timer-status').style.display = 'block';
            document.getElementById('timer-status').textContent = `Ujian "${examName}" telah diset untuk ${duration} menit`;
            document.getElementById('timer-status').className = 'alert alert-success';
            
            updateTimerDisplay();
            updateTeacherTimer();
            
            alert(`Ujian "${examName}" berhasil diset!`);
        }

        // Start Exam
        function startExam() {
            if (examState.duration <= 0) {
                alert('Silakan set ujian terlebih dahulu!');
                return;
            }
            
            examState.isActive = true;
            examState.isPaused = false;
            antiCheatActive = true;
            
            // Show exam interface to students
            document.getElementById('exam-waiting').classList.add('hidden');
            document.getElementById('exam-active').classList.remove('hidden');
            
            // Show Google Form if URL provided
            if (examState.googleFormUrl) {
                document.getElementById('google-form-container').classList.remove('hidden');
                const formUrl = convertToEmbedUrl(examState.googleFormUrl);
                document.getElementById('google-form-frame').src = formUrl;
            }
            
            // Force fullscreen for students
            enterFullscreen();
            document.getElementById('fullscreen-btn').style.display = 'block';
            
            // Start timer
            startTimer();
            
            // Ring bell to notify students
            ringBell();
            
            // Update UI
            document.getElementById('start-btn').textContent = '‚ñ∂Ô∏è Resume';
        }

        // Pause Exam
        function pauseExam() {
            if (!examState.isActive) return;
            
            examState.isPaused = !examState.isPaused;
            
            if (examState.isPaused) {
                clearInterval(examState.interval);
            } else {
                startTimer();
            }
        }

        // Stop Exam
        function stopExam() {
            examState.isActive = false;
            examState.isPaused = false;
            antiCheatActive = false;
            clearInterval(examState.interval);
            
            // Hide exam interface
            document.getElementById('exam-waiting').classList.remove('hidden');
            document.getElementById('exam-active').classList.add('hidden');
            document.getElementById('google-form-container').classList.add('hidden');
            document.getElementById('exam-ended').style.display = 'block';
            document.getElementById('fullscreen-btn').style.display = 'none';
            
            // Exit fullscreen
            exitFullscreen();
            
            // Ring bell to notify end
            ringBell();
            
            // Update UI
            document.getElementById('start-btn').textContent = '‚ñ∂Ô∏è Mulai';
            
            // Show exam results
            alert(`üìä Ujian Berakhir!\n\nüë§ Nama: ${studentName}\nüö® Total Pelanggaran: ${violationCount}/${maxViolations}\nüì± Tab Switch: ${tabSwitchCount} kali\nüéØ Focus Lost: ${focusLostCount} kali`);
        }

        // End exam manually by student
        function endExamManually() {
            if (confirm('Yakin ingin mengakhiri ujian? Pastikan Anda sudah submit jawaban di Google Form!')) {
                stopExam();
            }
        }

        // Reset All
        function resetAll() {
            if (confirm('Yakin ingin reset semua? Data ujian akan hilang.')) {
                stopExam();
                examState = {
                    isActive: false,
                    isPaused: false,
                    duration: 0,
                    remainingTime: 0,
                    examName: "",
                    googleFormUrl: "",
                    interval: null
                };
                
                // Reset anti-cheat
                violationCount = 0;
                tabSwitchCount = 0;
                focusLostCount = 0;
                antiCheatActive = false;
                
                // Reset UI
                document.getElementById('exam-name').value = '';
                document.getElementById('exam-duration').value = '';
                document.getElementById('google-form-url').value = '';
                document.getElementById('exam-title').textContent = 'Belum ada ujian yang diset';
                document.getElementById('timer-status').style.display = 'none';
                document.getElementById('exam-ended').style.display = 'none';
                document.getElementById('time-warning').style.display = 'none';
                document.getElementById('student-setup').style.display = 'block';
                document.getElementById('student-name').value = '';
                
                updateTimerDisplay();
                updateTeacherTimer();
                updateStatusIndicators();
            }
        }

        // Timer Functions
        function startTimer() {
            examState.interval = setInterval(() => {
                if (!examState.isPaused && examState.remainingTime > 0) {
                    examState.remainingTime--;
                    updateTimerDisplay();
                    updateTeacherTimer();
                    
                    // Warning when 5 minutes left
                    if (examState.remainingTime === 300) {
                        document.getElementById('time-warning').style.display = 'block';
                        ringBell();
                    }
                    
                    // Time's up
                    if (examState.remainingTime <= 0) {
                        stopExam();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const display = formatTime(examState.remainingTime);
            document.getElementById('timer-display').textContent = display;
            
            // Change color when time is running low
            const timerDiv = document.getElementById('timer-display');
            if (examState.remainingTime <= 300) { // 5 minutes
                timerDiv.style.color = '#dc2626';
            } else if (examState.remainingTime <= 600) { // 10 minutes
                timerDiv.style.color = '#d97706';
            } else {
                timerDiv.style.color = '#059669';
            }
        }

        function updateTeacherTimer() {
            const display = formatTime(examState.remainingTime);
            document.getElementById('teacher-timer').textContent = display;
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Anti-cheat Functions
        function initializeAntiCheat() {
            // Disable right-click
            document.addEventListener('contextmenu', function(e) {
                if (antiCheatActive) {
                    e.preventDefault();
                    recordViolation('Right-click terdeteksi');
                }
            });

            // Disable keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (!antiCheatActive) return;

                const forbiddenKeys = ['F12', 'F5', 'Escape'];
                const forbiddenCombos = [
                    {ctrl: true, shift: true, keyCode: 73}, // Ctrl+Shift+I
                    {ctrl: true, shift: true, keyCode: 74}, // Ctrl+Shift+J
                    {ctrl: true, shift: true, keyCode: 67}, // Ctrl+Shift+C
                    {ctrl: true, keyCode: 85}, // Ctrl+U
                    {ctrl: true, keyCode: 82}, // Ctrl+R
                    {alt: true, keyCode: 115}, // Alt+F4
                    {ctrl: true, keyCode: 87}, // Ctrl+W
                    {ctrl: true, keyCode: 84}, // Ctrl+T
                ];

                if (forbiddenKeys.includes(e.key)) {
                    e.preventDefault();
                    recordViolation(`Tombol terlarang: ${e.key}`);
                    return;
                }

                for (let combo of forbiddenCombos) {
                    if ((combo.ctrl && e.ctrlKey) && 
                        (combo.shift ? e.shiftKey : !e.shift) && 
                        (combo.alt ? e.altKey : !e.alt) && 
                        combo.keyCode === e.keyCode) {
                        e.preventDefault();
                        recordViolation('Kombinasi tombol terlarang');
                        return;
                    }
                }
            });

            // Detect tab switching
            document.addEventListener('visibilitychange', function() {
                if (!antiCheatActive) return;

                if (document.hidden) {
                    tabSwitchCount++;
                    recordViolation('Berpindah tab atau aplikasi');
                    updateTabStatus('danger');
                } else {
                    updateTabStatus('normal');
                }
            });

            // Detect window focus loss
            window.addEventListener('blur', function() {
                if (!antiCheatActive) return;
                
                focusLostCount++;
                recordViolation('Kehilangan fokus window');
                updateFocusStatus('danger');
            });

            window.addEventListener('focus', function() {
                if (!antiCheatActive) return;
                updateFocusStatus('normal');
            });

            // Detect fullscreen changes
            document.addEventListener('fullscreenchange', function() {
                if (!antiCheatActive) return;

                if (!document.fullscreenElement) {
                    isFullscreen = false;
                    recordViolation('Keluar dari fullscreen');
                    updateFullscreenStatus('danger');
                    
                    // Try to re-enter fullscreen
                    setTimeout(enterFullscreen, 1000);
                } else {
                    isFullscreen = true;
                    updateFullscreenStatus('normal');
                }
            });

            // Detect copy/paste attempts
            document.addEventListener('copy', function(e) {
                if (antiCheatActive) {
                    e.preventDefault();
                    recordViolation('Percobaan copy');
                }
            });

            document.addEventListener('paste', function(e) {
                if (antiCheatActive) {
                    e.preventDefault();
                    recordViolation('Percobaan paste');
                }
            });

            // Detect developer tools
            let devtools = {open: false, orientation: null};
            const threshold = 160;

            setInterval(function() {
                if (!antiCheatActive) return;

                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        recordViolation('Developer tools terdeteksi');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);

            updateStatusIndicators();
        }

        function recordViolation(reason) {
            violationCount++;
            console.log(`Violation ${violationCount}: ${reason} at ${new Date().toLocaleString()}`);
            
            showWarning(reason);
            
            if (violationCount >= maxViolations) {
                setTimeout(function() {
                    alert(`‚ùå Ujian berakhir karena terlalu banyak pelanggaran!\n\nTotal pelanggaran: ${violationCount}/${maxViolations}`);
                    stopExam();
                }, 2000);
            }
        }

        function showWarning(reason) {
            document.getElementById('warning-message').textContent = reason;
            document.getElementById('violation-count').textContent = violationCount;
            document.getElementById('warning-overlay').classList.add('show');
        }

        function hideWarning() {
            document.getElementById('warning-overlay').classList.remove('show');
            
            // Try to re-enter fullscreen if needed
            if (!document.fullscreenElement && antiCheatActive) {
                enterFullscreen();
            }
        }

        // Status indicator functions
        function updateStatusIndicators() {
            updateFocusStatus(document.hasFocus() ? 'normal' : 'danger');
            updateFullscreenStatus(document.fullscreenElement ? 'normal' : 'danger');
            updateTabStatus(document.hidden ? 'danger' : 'normal');
        }

        function updateFocusStatus(status) {
            const element = document.getElementById('focus-status');
            element.className = 'status-dot';
            if (status === 'danger') element.classList.add('danger');
            else if (status === 'warning') element.classList.add('warning');
        }

        function updateFullscreenStatus(status) {
            const element = document.getElementById('fullscreen-status');
            element.className = 'status-dot';
            if (status === 'danger') element.classList.add('danger');
            else if (status === 'warning') element.classList.add('warning');
        }

        function updateTabStatus(status) {
            const element = document.getElementById('tab-status');
            element.className = 'status-dot';
            if (status === 'danger') element.classList.add('danger');
            else if (status === 'warning') element.classList.add('warning');
        }

        // Fullscreen functions
        function enterFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => {
                    console.log('Fullscreen request failed:', err);
                });
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                exitFullscreen();
            } else {
                enterFullscreen();
            }
        }

        // Utility functions
        function convertToEmbedUrl(url) {
            if (url.includes('forms.gle/')) {
                return url;
            } else if (url.includes('docs.google.com/forms/')) {
                if (url.includes('/viewform')) {
                    return url.replace('/viewform', '/viewform?embedded=true');
                } else {
                    return url + (url.includes('?') ? '&' : '?') + 'embedded=true';
                }
            }
            return url;
        }

        // Bell Function
        function ringBell() {
            const bell = document.getElementById('bell-sound');
            const container = document.querySelector('.container');
            
            // Visual bell animation
            container.classList.add('bell-animation');
            setTimeout(() => {
                container.classList.remove('bell-animation');
            }, 500);
            
            // Try to play sound (might not work due to browser autoplay policy)
            try {
                bell.currentTime = 0;
                bell.play().catch(e => console.log('Audio autoplay blocked'));
            } catch (e) {
                console.log('Audio not supported');
            }
            
            // Show visual notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4f46e5;
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            `;
            notification.textContent = 'üîî BELL!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTimerDisplay();
            updateTeacherTimer();
            updateStatusIndicators();
            
            // Allow Enter key for login
            document.getElementById('teacher-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loginTeacher();
                }
            });

            // Allow Enter key for student name
            document.getElementById('student-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    registerStudent();
                }
            });

            // Update status indicators periodically
            setInterval(function() {
                if (antiCheatActive) {
                    updateStatusIndicators();
                }
            }, 1000);
        });

        // Prevent page refresh during exam
        window.addEventListener('beforeunload', function(e) {
            if (examState.isActive) {
                e.preventDefault();
                e.returnValue = '';
                return 'Ujian sedang berlangsung. Yakin ingin keluar?';
            }
        });

        // Additional security: Detect if user tries to open new window
        window.addEventListener('blur', function() {
            if (antiCheatActive && document.visibilityState === 'visible') {
                recordViolation('Membuka window baru');
            }
        });
    </script>
</body>
</html>